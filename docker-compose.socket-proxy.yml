# Docker Socket Proxy for Remote Hosts
#
# This file is used to deploy docker-socket-proxy on REMOTE hosts (e.g., Synology NAS)
# that you want to connect to Chrontainer.
#
# IMPORTANT: Do NOT run this on the same host as Chrontainer.
# This is for remote Docker hosts only.
#
# Usage:
#   1. Copy this file to your remote host
#   2. Run: docker-compose -f docker-compose.socket-proxy.yml up -d
#   3. Add the host in Chrontainer UI: tcp://remote-host-ip:2375
#
# Security:
#   - Only exposes safe, read-only Docker API endpoints
#   - Filters out dangerous operations (exec, build, etc.)
#   - Restrict port 2375 to trusted IPs using firewall rules

version: '3.8'

services:
  docker-socket-proxy:
    image: tecnativa/docker-socket-proxy:latest
    container_name: docker-socket-proxy
    restart: unless-stopped
    ports:
      - "2375:2375"
    volumes:
      # Mount Docker socket as read-only
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      # Core endpoints needed by Chrontainer
      - CONTAINERS=1      # List containers
      - POST=1            # Start/stop/restart containers
      - IMAGES=1          # List images
      - INFO=1            # Docker info
      - VERSION=1         # Docker version
      - PING=1            # Health check

      # Disabled endpoints for security
      - BUILD=0           # No image building
      - COMMIT=0          # No container commits
      - CONFIGS=0         # No configs
      - DISTRIBUTION=0    # No distribution
      - EXEC=0            # No exec into containers
      - NETWORKS=0        # No network management (optional, enable if needed)
      - NODES=0           # No swarm nodes
      - PLUGINS=0         # No plugins
      - SECRETS=0         # No secrets
      - SERVICES=0        # No services
      - SESSION=0         # No session
      - SWARM=0           # No swarm
      - SYSTEM=0          # No system operations
      - TASKS=0           # No tasks
      - VOLUMES=0         # No volume management (optional, enable if needed)
    networks:
      - docker-proxy

networks:
  docker-proxy:
    driver: bridge
